## [ITEM.57] 지역변수의 범위 최소화
- 기본적으로
  - 클래스의 멤버의 접근권한을 최소화하라(ITEM.15)와 유사
- **지역변수**의 유효 범위를 최소로 줄이면
  - 코드 가독성과 유지보수성이 높아지며, 오류 가능성이 낮아짐

### 지역변수의 역사
- C와 같은 프로그래밍 언어중에는
  - **지역변수**를 **코드 블록**의 첫머리에 선언하는 경우가 많음
- 자바에서는
  - **어느곳이든** 변수 선언이 가능함
  - C도 C99 표준부터는 변화됨

### 지역변수의 범위를 줄이는 방법
- 가장 처음 쓰일 때 선언하기
- 하지만, 사용전 미리 선언만 해두게 되면
  - 코드가 어수선해져, **가독성**이 떨어짐
- 변수를 실제로 사용하는 시점에
  - **타입**과, **초깃값**이 기억 안나는 등

### 지역변수 선언시 유의점
- 생각없이 선언하다 보면
  - 변수가 쓰이는 범위보다, 너무 앞서 선언하거나
  - 다 쓴 뒤에도 남아있는 경우가 있음
- **지역변수**의 **범위**는
  - 선언된 지점부터 그 지점을 포함한 블록이 끝날 때까지 이므로,
  - 실제 사용하는 블록 바깥에 선언할 경우
    - 블록 끝난 뒤에도 살아있게 됨
- 사용시 유의해야 함

### 지역변수의 선언과 초기화
- 거의 모든 지역변수는 **선언과 동시에 초기화**해야 함
- 초기화에 필요한 정보가 **충분하지 않을경우**
  - 충분해질때까지 **선언**을 미뤄야 한다
- `try-catch`문은 해당 규칙에서 예외
- 변수를 **초기화**하는 표현식에서
  - **검사 예외**를 던질 가능성이 있다면,
  - `try` 블록 안에서 초기화 해야 함
    - 그렇지 않을 경우, **예외**가 블록을 넘어, **메서드**에 전파 됨
- 변수를 `try` 블록 바깥에서 사용해야 하는 경우
  - 정확히 초기화 하진 못하더라도, `try`블록 앞에서 선언해야 함

### 반복문과 변수 범위
- 예전의 `for`형태, 최신의 `for-each`형태든,
  - 반복문에서는 **반복 변수(loop variable)의 범위**가
    - **반복문의 몸체**
    - 그리고 **for 키워드와 몸체 사이의 괄호안**으로 제한된다.
- 반복 변수의 값을, 반복문이 종료된 뒤에도 써야하는 상황이 아니라면
  - `while`문보다 `for`문을 쓰는편이 좋음
- 컬렉션이나 배열 순회 권장 관용구 예시
  ```java
  for (Element e : c) {
    ... // e로 무언가를 한다.
  }
  ```
- 반복자를 사용해야 하는 상황이라면
  - 반복자의 remove 메서드를 써야하는 등
  - `for-each` 문 대신 전통적은 `for`문을 쓰는 것이 나음
- 반복자 필요 관용구 예시
  ```java
  for (Iterator<Element> i = c.iterator(); i.hasNext(); ) {
    Element e = i.next();
    ... // e와 i로 무언가를 한다.
  }
  ```
- `for`문이 `while`문보다 나은 이유
  ```java
  Iterator<Element> i = c.iterator();
  while(i.hasNext()) {
    doSomething(i.next());
  }
  ...

  Iterator<Element> i2 = c2.iterator();
  while(i.hasNext()) { // 버그 발생
    doSomethingElse(i2.next());
  }
  ```
- 실수로 `i2`를 사용해야하는데, `i`를 사용한 경우
- `i`의 유효 범위는 아직 끝나지 않았기 때문에,
  - 코드는 컴파일도 잘 되고, 실행 예외도 발생하지 않음
- 하지만 두번째 `while`문은 `c2`를 순회하지 않고,
  - 곧장 끝나, `c2`가 비었다고 착각하게 만듦

### for-each의 장점
- `for`문을 사용하면 위의 오류를 **컴파일 타임**에 검출됨
  - 첫번째 반복문이 사용한 원소와
  - 반복자의 유효 범위가 반복문 종료와 함께 끝나기 때문
- 예시
  ```java
  for (Iterator<Element> i = c.iterator(); i.hasNext();) {
    Element e = i.next();
    ... // e와 i로 무언가를 한다.
  }

  for (Iterator<Element> i2 = c2.iterator(); i.hasNext();) {
    Element e2 = i2.next();
    // e2와 i2로 무언가를 한다.
  }
  ```
  - 두번째 구문에서, `i`를 찾을 수 없다는 에러가 발생함
- **변수 유효 범위**가 `for`문과 일치하기 때문에
  - 똑같은 이름의 변수를 여러 반복문에서 사용하더라도
  - 아무런 영향을 주지 않음
- `while`문보다 짧아, 가독성이 좋음
  - 예시
    ```java
    for(int i=0, n = expensiveComputation(); i<n; i++) {
      ... // i로 무언가를 한다.
    }
    ```
  - 범위가 정확히 일치하는 `n`과 `i`
    - 반복 여부를 결정짓는 `i`의 한계값을, `n`에 저장하여
    - 반복때마다 **재계산**해야 하는 비용이 줄어 듦
  - **같은 값을 반환하는 메서드**를 매번 호출한다면
    - 위와 같은 관용구 사용

### 지역변수 최소화 방법
- **메서드**를 작게 유지하고, 한 기능에 집중하기
- 한 메서드에서 여러 기능을 처리할 경우
  - 그중 한 기능과 관련된 **지역변수**라도
  - 다른 기능을 수행하는 코드에서 접근 가능해짐
- 메서드를 단수히 기능별로 쪼개면 문제는 해결됨