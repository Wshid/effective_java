## [ITEM.66] 네이티브 메서드
### JNI(Java Native Interface)
- 자바 프로그램이 네이티브 메서드를 호출하는 기술
- 네이티브 메서드
  - `C`나 `C++`같은
  - 네이티브 프로그래밍 언어로 작성한 메서드를 의미

### Native Method의 주요 사용처
- 레지스트리 같은 **플랫폼 특화 기능** 사용
- 네이티브 코드로 작성된 **기존 라이브러리** 사용
  - 레거시 데이터를 사용하는 **레거시 라이브러리**가 그 예시
- **성능 개선**을 목적으로 성능에 결정적인 영향을 주는 영역만 따로
  - 네이티브 언어로 작성

### 플랫폼 특화 기능 활용 - 네이티브 메서드 사용
- 네이티브 메서드를 사용해야 함
- 자바가 발전해가면서
  - OS와 같은 **하부 플랫폼**의 기능을 점점 흡수중
- 따라서, 네이티브 메서드를 사용할 필요가 점점 **줄어듦**
- `java 9`에서는 `process API`를 추가해
  - OS 프로세스에 접근 가능
- 대체할 만한 자바 라이브러리가 **없을 때**는 사용행 ㅑ함

### 성능 개선 목적 - 네이티브 메서드 사용
- 비권장
- 자바 초기(`java :3`)의 경우엔 필요하나,
  - `JVM`이 많이 발전하면서, 필요가 없어짐
- `java.math`가 추가된
  - `java 1.1`의 `BigInteger`는
    - `C`로 작성한 고성능 라이브러리에 의존했으나,
  - `java 3`, 순수 자바로 재구현 되면서
    - 원래의 네이티브 메서드보다 **성능이 좋음**
    - 이후 `BigInteger`는 큰 개선이 없었음
      - `java 8`에서 큰 수의 곱셈 기능 개선 외..

### 네이티브 라이브러리의 발전
- `GNU` 다중 정밀 연산 라이브러리(GMP)의 작업이 계쏙 됨
- 따라서, 정말 고성능의 **다중 정밀 연산**이 필요한 자바 프로그래머라면,
  - 네이티브 메서드를 활용해 `GMP`를 사용하는 것을 고려 해야 함

### 네이티브 메서드의 단점
- 네이티브 언어는 **안전하지 않음**(ITEM.50)
  - 네이티브 메서드를 사용하는 어플리케이션도,
  - **메모리 훼손 오류**로부터 안전하지 않음
- 네이티브 언어는 자바보다 **플랫폼**을 많이 의존하기 때문에
  - **이식성이 낮음**
- 디버깅이 **어려움**
- 주의하지 않으면 속도가 더 **느림**
- `GC`가 네이티브 메서드는 자동 회수하지 않음
  - 심지어 추적 불가능(ITEM.8)
- **자바 코드**와 **네이티브 코드**의 경계를 넘을 때
  - 비용이 추가 됨
- 네이티브 메서드와 자바 코드간 `glue code`를 작성해야 하며,
  - 귀찮을뿐더러 **가독성이 낮음**

### 정리
- 네이티브 메서드는 신중히 사용할 것
- 네이티브 메서드가 **성능 개선**을 해주는 경우는 많지 않음
- **저수준 자원**이나 **네이티브 라이브러리**를 사용해야만 할 때는,
  - 네이티브 코드는 **최소한**으로 사용
  - 철저히 **테스트** 필요
- 네이티브 코드 안의 버그는
  - 전체 어플리케이션에 악영향